{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://react-discipline-skills/scripts/schemas/skill4_input.schema.json",
  "title": "Implementation Discipline Input Envelope",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "task_request": {
      "type": "string",
      "minLength": 1
    },
    "detection_result": {
      "type": "object"
    },
    "revised_plan": {
      "type": "object"
    },
    "micro_change_context": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "behavior_preserving_refactor",
        "touched_files_max",
        "no_new_files",
        "no_moves_or_renames",
        "no_new_endpoints_hooks_composites",
        "no_routing_changes",
        "in_place_refactor"
      ],
      "properties": {
        "behavior_preserving_refactor": {
          "const": true
        },
        "touched_files_max": {
          "type": "integer",
          "minimum": 1,
          "maximum": 2
        },
        "no_new_files": {
          "const": true
        },
        "no_moves_or_renames": {
          "const": true
        },
        "no_new_endpoints_hooks_composites": {
          "const": true
        },
        "no_routing_changes": {
          "const": true
        },
        "in_place_refactor": {
          "const": true
        }
      }
    },
    "policy_ref": {
      "type": "string",
      "minLength": 1
    },
    "policy_version": {
      "type": "string",
      "minLength": 1
    },
    "diff_preference": {
      "type": "string",
      "enum": [
        "snippet_first",
        "unified_diff"
      ]
    },
    "strictness": {
      "type": "string",
      "enum": [
        "strict",
        "relaxed"
      ]
    },
    "max_lines_policy": {
      "type": "object"
    }
  },
  "oneOf": [
    {
      "required": [
        "detection_result",
        "revised_plan"
      ]
    },
    {
      "required": [
        "task_request",
        "micro_change_context"
      ]
    }
  ]
}
