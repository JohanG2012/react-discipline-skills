{
  "detection_result": {
    "schema_version": "1.1.0",
    "skill": "react-architecture-detection",
    "version": "1.0.0",
    "result_type": "detection_result",
    "validation_status": {
      "is_valid": true,
      "stage": "finalized",
      "errors": [],
      "warnings": []
    },
    "routing": {
      "type": "react-router",
      "entry_points": [
        "src/main.tsx",
        "src/router.tsx"
      ]
    },
    "ui": {
      "home": "src/components",
      "confidence": 0.89,
      "status": "resolved",
      "evidence_paths": [
        "src/components",
        "src/components/ui"
      ]
    },
    "api": {
      "pattern": "services",
      "home": "unknown",
      "confidence": 0.62,
      "status": "ambiguous",
      "evidence_paths": [
        "src/services",
        "src/api",
        "src/lib/http"
      ]
    },
    "domain": {
      "organization": "features",
      "home": "src/features",
      "confidence": 0.86,
      "status": "resolved",
      "evidence_paths": [
        "src/features"
      ]
    },
    "state": {
      "server": "react-query",
      "client": "zustand",
      "home": "src/store",
      "confidence": 0.81,
      "status": "resolved",
      "evidence_paths": [
        "src/store"
      ]
    },
    "gravity_map": {
      "pages_or_routes": "src/pages",
      "domain_modules": "src/features",
      "ui_primitives": "src/components/ui",
      "ui_composites": "src/components/composites",
      "api": "unknown",
      "store": "src/store",
      "pure_utils": "src/lib",
      "generic_hooks": "src/hooks",
      "app_setup": "src/core"
    },
    "alignment_score": 82,
    "alignment": {
      "blockers": [
        "Competing API homes (`src/services` and `src/api`) reduce placement clarity."
      ],
      "next_migration_step": "Adopt src/services/api as the canonical endpoint layer for this task."
    },
    "strategy": "follow-existing",
    "strategy_rationale": [
      "Current repository gravity is stable enough outside the ambiguous API concern.",
      "Introducing competing homes would increase migration risk for this task scope."
    ],
    "strategy_basis": [
      "low-migration-churn"
    ],
    "bootstrap": {
      "triggered": false
    },
    "notes": [
      "Detected mixed route and API conventions; bootstrap mode not required."
    ],
    "pause_decision": {
      "pause_required": true,
      "pause_mode": "balanced",
      "decision_safety_confidence": 0.64,
      "impact": "structural",
      "trigger": "Competing data-access homes with low confidence",
      "options": [
        "Treat src/services/api as canonical endpoint layer",
        "Treat src/api/endpoints as canonical endpoint layer"
      ],
      "recommended_option": "Treat src/services/api as canonical endpoint layer"
    }
  },
  "revised_plan": {
    "source_plan_ref": "placement-plan://sample",
    "context_decisions": {
      "feature_owner_domain": "projects",
      "route_page_involvement": "route",
      "data_sources_summary": [
        "src/api/endpoints/projects.ts",
        "src/api/dto/project.dto.ts"
      ],
      "state_type": "server-state",
      "ui_need_shape": "feature section with shared composite reuse"
    },
    "file_actions": [
      {
        "action": "reuse",
        "path": "src/ui/composites/FilterBar.tsx",
        "needed_artifact_id": "na-filter-bar"
      },
      {
        "action": "update",
        "path": "src/ui/composites/Toolbar.tsx",
        "needed_artifact_id": "na-toolbar-actions"
      },
      {
        "action": "create",
        "path": "src/features/projects/sections/ProjectInsightsSection.tsx",
        "needed_artifact_id": "na-project-domain-section"
      }
    ],
    "layer_justifications": [
      {
        "layer": "ui/composites",
        "justification": "Shared layout affordances belong in composites because behavior is presentation-driven and reusable.",
        "adjacent_layers_not_chosen": "Feature sections were not chosen because this behavior is not domain-specific."
      },
      {
        "layer": "features/projects/sections",
        "justification": "Domain behavior diverges enough to keep orchestration in a project-owned section.",
        "adjacent_layers_not_chosen": "Shared composites were not chosen to avoid domain leakage through mode flags."
      }
    ],
    "decisions": [
      {
        "needed_artifact_id": "na-filter-bar",
        "decision": "reuse",
        "decision_mark": "reuse as-is",
        "discovery_status": "found",
        "discovery_paths": [
          "src/ui/composites/FilterBar.tsx"
        ],
        "target_path": "src/ui/composites/FilterBar.tsx",
        "chosen_candidate_id": "cand-filter-bar",
        "score_profile": {
          "fit": 9,
          "complexity_cost": 2,
          "coupling_risk": 2,
          "divergence_risk": 3,
          "locality_benefit": 8
        },
        "reasons": [
          "Existing composite matches required behavior without threshold violations."
        ],
        "override_required": false
      },
      {
        "needed_artifact_id": "na-toolbar-actions",
        "decision": "update",
        "decision_mark": "updated",
        "discovery_status": "found",
        "discovery_paths": [
          "src/ui/composites/Toolbar.tsx",
          "src/ui/composites/ActionBar.tsx"
        ],
        "target_path": "src/ui/composites/Toolbar.tsx",
        "chosen_candidate_id": "cand-toolbar",
        "score_profile": {
          "fit": 7,
          "complexity_cost": 3,
          "coupling_risk": 2,
          "divergence_risk": 4,
          "locality_benefit": 7
        },
        "tie_break": {
          "applied": false,
          "ordered_criteria": [
            "authoritative_home",
            "coupling_risk",
            "divergence_risk",
            "complexity_cost",
            "lexical_path"
          ]
        },
        "reasons": [
          "Adding one generic action slot stays within update thresholds."
        ],
        "override_required": false
      },
      {
        "needed_artifact_id": "na-project-domain-section",
        "decision": "new",
        "decision_mark": "new",
        "discovery_status": "found",
        "discovery_paths": [
          "src/features/tasks/sections/TaskInsightsSection.tsx"
        ],
        "target_path": "src/features/projects/sections/ProjectInsightsSection.tsx",
        "score_profile": {
          "fit": 4,
          "complexity_cost": 5,
          "coupling_risk": 6,
          "divergence_risk": 8,
          "locality_benefit": 9
        },
        "reasons": [
          "No existing section supports the domain behavior without leakage."
        ],
        "override_required": false
      },
      {
        "needed_artifact_id": "na-shared-grid-mode-switch",
        "decision": "decision_blocked",
        "decision_mark": "decision_blocked",
        "discovery_status": "found",
        "discovery_paths": [
          "src/ui/composites/GridShell.tsx"
        ],
        "reasons": [
          "All candidate updates require domain-mode flags in a shared composite."
        ],
        "constraint_blockers": [
          "Constraint avoid_new_artifacts=true conflicts with anti-leakage guardrails."
        ],
        "override_required": true
      }
    ],
    "guardrails": [
      "No domain flags in shared composites.",
      "Prefer domain-owned sections when divergence risk is high.",
      "Do not introduce new shared/common dumping-ground abstractions.",
      "Do not bypass endpoint layers from hooks or UI.",
      "Do not place reusable utilities inline in pages/sections when they belong in domain/lib.",
      "Do not expand shared components with excessive mode/flag complexity.",
      "Do not force multi-mode shared composites when section-level duplication is safer.",
      "Do not include refactor-for-future churn without immediate value.",
      "Do not mix migration and feature behavior churn in one package unless explicitly requested."
    ],
    "notes": [
      "Decision package is deterministic and downstream-consumable.",
      "Decisions demonstrate reuse, update, new, and blocked outcomes."
    ]
  },
  "policy_ref": "agent-policy-v1",
  "policy_version": "1.0.0"
}
