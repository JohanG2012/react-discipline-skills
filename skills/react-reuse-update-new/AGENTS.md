<!--
DO NOT EDIT THIS FILE DIRECTLY.

This file is generated from ./.shared-rules/*.md and ./rules/*.md
Edit the rule source files instead, then recompile.

Generated on: 2026-02-28
-->

# React Reuse vs Update vs New â€” Agent Rule Index

## Overview
This document defines the authoritative lookup index for agents/LLMs using the `react-reuse-update-new` skill.

Shared baseline policy is materialized per skill in `./.shared-rules/` to keep this skill portable when installed standalone.

Read behavior:
- `inline` rules are embedded below and must be treated as always-on guidance.
- `reference` rules are listed in the index; load them from their source file when relevant.

Inline rules in this document: 4.

## Rule Lookup Index
| Rule ID | Rule | Priority | Mode | Covers | Rationale | Source |
| --- | --- | --- | --- | --- | --- | --- |
| `sr-overview-scope` | Skill Scope Definition | MUST | `reference` | Skill Scope Definition. | Keeps shared baseline governance and scope constraints explicit. | `.shared-rules/00_overview.md` |
| `sr-overview-nongoals` | Baseline Non-goals | MUST | `reference` | Baseline Non-goals. | Prevents policy drift into implementation-specific prescriptions. | `.shared-rules/00_overview.md` |
| `sr-constraints` | Minimal Scope Enforcement | MUST | `reference` | Minimal Scope Enforcement. | Prevents uncontrolled scope expansion and dependency creep. | `.shared-rules/10_constraints.md` |
| `sr-scope-governor` | Scope Governor Hard Defaults | MUST | `reference` | Scope Governor Hard Defaults. | Controls churn and keeps delivery bounded. | `.shared-rules/10_constraints.md` |
| `sr-governance` | Governance Compliance | MUST | `reference` | Governance Compliance. | Ensures policies are enforced consistently across changes. | `.shared-rules/20_governance.md` |
| `sr-architecture-boundaries` | Architecture and Dependency Boundaries | MUST | `reference` | Architecture and Dependency Boundaries. | Ensures all downstream skills enforce one consistent architecture and import-boundary model. | `.shared-rules/30_architecture_boundaries.md` |
| `sr-ownership-naming` | Ownership and Naming Contract | MUST | `reference` | Ownership and Naming Contract. | Keeps responsibility boundaries and naming deterministic across all downstream specs. | `.shared-rules/40_ownership_naming.md` |
| `sr-decision-defaults` | Deterministic Defaults and Pause Protocol | MUST | `reference` | Deterministic Defaults and Pause Protocol. | Reduces unnecessary clarification loops while protecting high-impact structural decisions. | `.shared-rules/50_decision_defaults.md` |
| `sr-output-discipline` | Output and Planning Discipline | MUST | `inline` | Output and Planning Discipline. | Keeps downstream planning and implementation outputs consistent, compact, and reviewable. | `.shared-rules/60_output_discipline.md` |
| `sr-dod-baseline` | Completion and Quality Baseline | MUST | `reference` | Completion and Quality Baseline. | Ensures every downstream skill validates critical correctness and safety gates before completion. | `.shared-rules/70_quality_baseline.md` |
| `sr-planning-reuse` | Planning and Reuse Workflow | MUST | `reference` | Planning and Reuse Workflow. | Prevents ad hoc implementation choices and improves consistency across downstream planning outputs. | `.shared-rules/80_planning_reuse_workflow.md` |
| `sr-migration-placement` | Migration and Placement Strategy | MUST | `reference` | Migration and Placement Strategy. | Prevents mixed-architecture drift and keeps placement decisions deterministic in legacy or evolving repositories. | `.shared-rules/90_migration_placement.md` |
| `sr-fallback-defaults` | Fallback Technology Defaults | MUST | `reference` | Fallback Technology Defaults. | Ensures deterministic cross-skill defaults while honoring existing repository gravity first. | `.shared-rules/100_fallback_defaults.md` |
| `sr-implementation-defaults` | Implementation Defaults | MUST | `reference` | Implementation Defaults. | Aligns downstream implementation behavior on quality, environment access, logging, and tooling posture. | `.shared-rules/110_implementation_defaults.md` |
| `sr-layer-contracts` | Layer Contracts and Error Ownership | MUST | `reference` | Layer Contracts and Error Ownership. | Keeps ownership deterministic across pages, features, UI, API, store, core, hooks, lib, and config. | `.shared-rules/120_layer_contracts.md` |
| `sr-access-write-control` | Access and Write Control | MUST | `reference` | Access and Write Control. | Keeps structural decisions grounded in repository signals and maintains controlled, reviewable changes. | `.shared-rules/130_access_write_control.md` |
| `sr-file-size-guidance` | File Size and Responsibility Guidance | SHOULD | `reference` | File Size and Responsibility Guidance. | Encourages maintainable module boundaries and limits responsibility drift. | `.shared-rules/140_file_size_guidance.md` |
| `sr-architecture-detection-contract` | Architecture Detection Output and Bootstrap Contract | MUST | `reference` | Architecture Detection Output and Bootstrap Contract. | Ensures all downstream skills consume one consistent architecture-detection result and bootstrap behavior. | `.shared-rules/150_architecture_detection_contract.md` |
| `sr-enforcement-heuristics` | Enforcement Heuristics | SHOULD | `reference` | Enforcement Heuristics. | Provides consistent review heuristics across downstream skills without over-prescribing implementation details. | `.shared-rules/160_enforcement_heuristics.md` |
| `sr-micro-change-bypass` | Micro-change Bypass and Skill 4 Micro Mode | MUST | `reference` | Micro-change Bypass and Skill 4 Micro Mode. | Allows low-risk behavior-preserving refactors to stay fast while still enforcing implementation discipline and boundary checks. | `.shared-rules/170_micro_change_bypass.md` |
| `sr-component-folderization` | Component and Client Module Folderization Threshold Index | MUST | `reference` | Component and Client Module Folderization Threshold. | Preserves a stable entrypoint while delegating to focused component and client-threshold rules. | `.shared-rules/180_component_folderization.md` |
| `sr-component-file-threshold` | Component File Folderization Threshold | MUST | `reference` | Component File Folderization Threshold. | Keeps components maintainable by triggering folderization when size/responsibility thresholds are exceeded. | `.shared-rules/180_component_folderization.md` |
| `sr-client-module-threshold` | Transport Client Module Threshold | MUST | `reference` | Transport Client Module Threshold. | Prevents mega transport clients by keeping endpoint orchestration out of shared client foundations. | `.shared-rules/180_component_folderization.md` |
| `sr-component-folder-structure` | Folder Structure for a Folderized Component | MUST | `reference` | Folder Structure for a Folderized Component. | Prevents random folder soup and keeps discovery/search predictable. | `.shared-rules/180_component_folderization.md` |
| `sr-component-folder-exports` | Naming and Exports Inside Folderized Components | MUST | `reference` | Naming and Exports Inside Folderized Components. | Keeps imports stable and grep-friendly. | `.shared-rules/180_component_folderization.md` |
| `sr-component-helper-promotion` | Promotion and Demotion for Component Helpers | MUST | `reference` | Promotion and Demotion for Component Helpers. | Prevents leaking component-specific helpers into global utility layers. | `.shared-rules/180_component_folderization.md` |
| `sr-folderization-no-new-home` | Folderization Must Not Create a New Home | MUST | `reference` | Folderization Must Not Create a New Home. | Prevents second-architecture drift. | `.shared-rules/180_component_folderization.md` |
| `sr-layout-shell-placement` | Layout and Shell Ownership Decision | MUST | `reference` | Layout and Shell Ownership Decision. | Removes ambiguity between `ui/primitives`, `ui/composites`, and `features/<domain>/sections` for layout-like components. | `.shared-rules/190_layout_shell_placement.md` |
| `sr-layout-shell-subfolder-policy` | Layout and Shell Subfolder Policy | MUST | `reference` | Layout and Shell Subfolder Policy. | Prevents creation of competing layout homes while allowing bounded categorization inside composites when needed. | `.shared-rules/190_layout_shell_placement.md` |
| `sr-ui-classname-support` | `className` Support Policy | MUST | `reference` | className Support Policy. | Keeps shared UI extensible without forcing styling props everywhere or creating style-override soup. | `.shared-rules/200_ui_accessibility_policies.md` |
| `sr-a11y-aria-label` | `aria-label` and Accessible Name Policy | MUST | `reference` | aria-label and Accessible Name Policy. | Prevents noisy or incorrect ARIA usage while ensuring interactive controls always have an accessible name. | `.shared-rules/200_ui_accessibility_policies.md` |
| `sr-dom-rendering-and-primitives` | DOM Rendering and Primitive Discipline Index | MUST | `reference` | DOM Rendering and Primitive Discipline. | Preserves backward-compatible entrypoint while delegating enforcement to narrowly scoped rules. | `.shared-rules/210_dom_rendering_and_primitive_discipline.md` |
| `sr-dom-rendering-boundaries` | DOM Rendering Boundaries | MUST | `reference` | DOM Rendering Boundaries. | Prevents JSX/DOM leakage into logic/data layers. | `.shared-rules/210_dom_rendering_and_primitive_discipline.md` |
| `sr-primitive-creation-threshold` | Primitive Creation Threshold and Raw DOM Usage | MUST | `reference` | Primitive Creation Threshold and Raw DOM Usage. | Keeps raw DOM use pragmatic while preventing repeated semantic reimplementation. | `.shared-rules/210_dom_rendering_and_primitive_discipline.md` |
| `sr-shared-ui-domain-discipline` | Shared UI Domain Discipline | MUST | `reference` | Shared UI Domain Discipline. | Keeps shared UI reusable and prevents domain/transport leakage. | `.shared-rules/210_dom_rendering_and_primitive_discipline.md` |
| `sr-prop-count-caps` | Prop Count Caps and Escalation Actions | SHOULD | `reference` | Prop Count Caps and Escalation Actions. | Prevents prop soup and abstraction creep by enforcing responsibility boundaries and preferring composition/wrappers over flag matrices. | `.shared-rules/220_prop_count_caps.md` |
| `sr-mega-file-triage` | Mega-File Triage and Extraction Plan Index | MUST | `reference` | Mega-File Triage and Extraction Plan. | Preserves stable entrypoint while delegating to focused triage, extraction-sequencing, and validation-output rules. | `.shared-rules/230_mega_file_triage.md` |
| `sr-mega-file-trigger-safety` | Mega-File Trigger and Safety Baseline | MUST | `reference` | Mega-File Trigger and Safety Baseline. | Ensures deterministic trigger conditions and behavior-preserving triage defaults. | `.shared-rules/230_mega_file_triage.md` |
| `sr-mega-file-extraction-order` | Mega-File Extraction Ordering | MUST | `reference` | Mega-File Extraction Ordering. | Keeps decomposition predictable and low-risk. | `.shared-rules/230_mega_file_triage.md` |
| `sr-mega-file-validation-output` | Mega-File Safety Checks and Output Contract | MUST | `inline` | Mega-File Safety Checks and Output Contract. | Enforces post-step safety evidence and deterministic output shape. | `.shared-rules/230_mega_file_triage.md` |
| `sr-prop-grouping-discipline` | Prop Grouping Discipline | SHOULD | `reference` | Prop Grouping Discipline. | Keeps prop grouping intentional and cohesive while preventing config-bag anti-patterns that hide responsibility drift. | `.shared-rules/240_prop_grouping_discipline.md` |
| `sr-i18n-text-extraction` | i18n Extraction for User-Facing UI Text | MUST | `reference` | i18n Extraction for User-Facing UI Text. | Prevents hardcoded copy drift and keeps user-facing text maintainable, localizable, and consistent. | `.shared-rules/250_i18n_text_extraction.md` |
| `sr-type-like-maybe` | `*Like` and `Maybe<T>` Discipline Index | MUST | `reference` | *Like and Maybe<T> Discipline. | Preserves backward-compatible entrypoint while delegating to single-focus type rules. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-type-like-boundary` | `*Like` Boundary Discipline | MUST | `reference` | *Like Boundary Discipline. | Restricts structural compatibility types to boundary layers. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-type-maybe-semantics` | `Maybe<T>` Semantics Discipline | MUST | `reference` | Maybe<T> Semantics Discipline. | Enforces one explicit repository-wide optionality semantic. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-domain-type-integrity` | Domain Type Integrity | MUST | `reference` | Domain Type Integrity. | Keeps domain-layer contracts strict and canonical. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-tests-aria-label-selectors` | Test Selectors and `aria-label` Usage | MUST | `reference` | Test Selectors and aria-label Usage. | Keep tests user-centric and stable without abusing accessibility attributes as test-only hooks. | `.shared-rules/270_tests_aria_label_selectors.md` |
| `sr-no-duplicate-ui-patterns` | No Duplicate UI Patterns (Composites) | MUST | `reference` | No Duplicate UI Patterns (Composites). | Prevent parallel implementations of the same UI interaction pattern that cause drift, inconsistent behavior, and refactor churn. | `.shared-rules/280_no_duplicate_ui_patterns.md` |
| `sr-browser-side-effects-boundary` | Browser Side-Effects and Routing Boundary | MUST | `reference` | Browser Side-Effects and Routing Boundary. | Prevents hidden routing/app side-effects from leaking into UI/feature components and keeps navigation/history ownership deterministic. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-no-empty-catch` | Empty Catch and Swallowed Error Discipline | MUST | `reference` | Empty Catch and Swallowed Error Discipline. | Silent failures destroy debuggability and make behavior nondeterministic. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-jsx-logic-density` | JSX Logic Density and Handler Extraction | SHOULD | `reference` | JSX Logic Density and Handler Extraction. | Prevents JSX from becoming an execution script and improves readability/testability without premature performance optimization. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-time-derived-state` | Time and "Now" Semantics in Derived State | SHOULD | `reference` | Time and "Now" Semantics in Derived State. | Prevents hidden time dependencies that create stale values, flaky tests, and inconsistent behavior. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-hidden-interactive-controls` | Hidden Interactive Controls and Accessibility Contract | MUST | `reference` | Hidden Interactive Controls and Accessibility Contract. | Prevents invisible/focus-trap controls and accessibility regressions from CSS hiding patterns. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-features-no-cross-deps` | No Cross-Feature Dependencies | MUST | `reference` | No Cross-Feature Dependencies. | Preserve clear ownership and prevent feature-graph coupling that causes architectural drift and refactor explosions. | `.shared-rules/300_features_no_cross_deps.md` |
| `sr-types-assertion-discipline` | Type Assertion Discipline (`as T`) | MUST | `reference` | Type Assertion Discipline (as T). | Allow necessary inference help without enabling type lies that bypass boundaries, validation, and domain integrity. | `.shared-rules/310_types_assertion_discipline.md` |
| `sr-types-double-assertion` | Double Type Assertion Discipline (`as unknown as T`) | MUST | `reference` | Double Type Assertion Discipline (as unknown as T). | Prevents silencing type errors and leaking unsafe shapes across boundaries while allowing rare, justified boundary interop. | `.shared-rules/320_types_double_assertion_discipline.md` |
| `sr-import-alias-suggestion` | Deep Relative Imports Should Trigger `@/` Alias Suggestion | MUST | `reference` | Deep Relative Imports Should Trigger @/ Alias Suggestion. | Reduces brittle path traversal noise while keeping alias adoption as an explicit, human-approved tooling decision. | `.shared-rules/330_import_alias_suggestion.md` |
| `sr-feature-split-domain-extraction` | Umbrella Feature Split and Domain Extraction | MUST | `reference` | Umbrella Feature Split and Domain Extraction. | Prevent feature folders from turning into umbrella owners that hide multiple domains and destabilize placement/reuse boundaries. | `.shared-rules/340_feature_split_domain_extraction.md` |
| `sr-feature-components-scope` | What May Live in `features/<domain>/components/` | MUST | `reference` | What May Live in features/<domain>/components/. | Prevents feature components from becoming a second shared UI home or hiding domain/transport logic in presentation files. | `.shared-rules/350_feature_components_scope.md` |
| `sr-no-feature-api-home` | No `api/` Inside Features When Canonical API Home Exists | MUST | `reference` | No api/ Inside Features When Canonical API Home Exists. | Preserves one-home-per-concern for transport ownership and prevents endpoint drift into feature folders. | `.shared-rules/360_no_feature_api_home.md` |
| `sr-no-feature-views` | No `views/` or `*View` in Features | MUST | `reference` | No views/ or *View in Features. | Keeps presentation ownership deterministic across pages, sections, and components without introducing duplicate view layers. | `.shared-rules/370_no_feature_views.md` |
| `sr-filename-length` | File Name Length Discipline | MUST | `reference` | File Name Length Discipline. | Long file names reduce grepability, readability, and review velocity, and often signal mixed responsibilities. | `.shared-rules/380_filename_length_policy.md` |
| `sr-output-mode-resolution` | Output Mode Resolution and Display Safety | MUST | `inline` | Output Mode Resolution and Display Safety. | Prevents accidental machine-mode output to humans and enforces deterministic mode selection. | `.shared-rules/390_output_mode_resolution.md` |
| `sr-props-drilling-discipline` | Prop Drilling Discipline and Escalation | SHOULD | `reference` | Prop Drilling Discipline and Escalation. | Keep component trees readable and maintainable by limiting pass-through wiring while preserving clear ownership boundaries. | `.shared-rules/400_prop_drilling_discipline.md` |
| `sr-feature-definition` | Feature Definition and Composition Boundary | MUST | `reference` | Feature Definition and Composition Boundary. | Keeps feature ownership explicit and prevents route/transport/layout drift into feature boundaries. | `.shared-rules/410_feature_definition.md` |
| `sr-feature-capability-clusters` | Capability Cluster Policy Inside Feature Owners | MUST | `reference` | Capability Cluster Policy Inside Feature Owners. | Prevents premature taxonomy growth while making structural extraction criteria deterministic when feature scope expands. | `.shared-rules/420_feature_capability_clusters.md` |
| `sr-capability-to-feature-split` | Capability Promotion to Feature Owner | MUST | `reference` | Capability Promotion to Feature Owner. | Prevents both premature feature explosion and hidden feature-sized ownership inside one folder. | `.shared-rules/430_capability_to_feature_split.md` |
| `sr-feature-state-policy` | Feature-Local State Admission and Graduation | MUST | `reference` | Feature-Local State Admission and Graduation. | Prevents unnecessary state layers while preserving explicit ownership for durable cross-route client state. | `.shared-rules/440_feature_state_policy.md` |
| `sr-capability-domain-scope` | Capability-Level Domain Scope and Promotion | MUST | `reference` | Capability-Level Domain Scope and Promotion. | Allows local domain specialization without fragmenting canonical feature domain ownership. | `.shared-rules/450_capability_domain_scope.md` |
| `sr-feature-too-big-triggers` | Feature Size Governance Triggers | MUST | `reference` | Feature Size Governance Triggers. | Keeps oversized feature drift detectable and action-oriented without forcing unsafe broad restructures. | `.shared-rules/460_feature_too_big_triggers.md` |
| `sr-capability-folder-naming` | Capability Folder Naming and Reserved Names | MUST | `reference` | Capability Folder Naming and Reserved Names. | Keeps capability structure searchable and prevents generic dumping-ground taxonomy drift. | `.shared-rules/470_capability_folder_naming.md` |
| `rru-overview-scope` | Skill Scope Definition | MUST | `reference` | Skill Scope Definition. | Ensures reuse decisions stay within defined responsibilities. | `rules/00_overview.md` |
| `rru-process` | Decision Ladder | MUST | `reference` | Decision Ladder. | Keeps decisions consistent and bounded. | `rules/10_process.md` |
| `rru-output` | Structured Decision Output | MUST | `inline` | Structured Decision Output. | Ensures decisions are actionable and traceable. | `rules/20_output.md` |
| `rru-discovery-conventions` | Discovery Coverage and Convention Fit | MUST | `reference` | Discovery Coverage and Convention Fit. | Prevents duplicate artifacts and style drift by forcing evidence-based discovery in the active repository. | `rules/30_discovery_conventions.md` |
| `rru-default-bias` | Deterministic Defaults and Pause Discipline | MUST | `reference` | Deterministic Defaults and Pause Discipline. | Reduces over-asking and ensures predictable outcomes when ambiguity exists but safe defaults are available. | `rules/40_default_bias.md` |
| `rru-upstream-alignment` | Upstream Decision Alignment | MUST | `reference` | Upstream Decision Alignment. | Keeps reuse decisions coherent with prior skills and prevents conflicting structural guidance. | `rules/50_upstream_alignment.md` |
| `rru-decision-thresholds` | Outcome Threshold Interpretation | MUST | `reference` | Outcome Threshold Interpretation. | Converts scoring into predictable decisions and prevents reviewer-dependent outcomes. | `rules/60_decision_thresholds.md` |
| `rru-scope-governor` | Scope Cap Enforcement | MUST | `reference` | Scope Cap Enforcement. | Prevents refactor creep and keeps decision packages reviewable. | `rules/70_scope_governor.md` |
| `rru-access-control` | Read/Search Access and Fallback Bundle | MUST | `reference` | Read/Search Access and Fallback Bundle. | Reuse decisions require repository evidence; fallback inputs must be explicit when direct access is unavailable. | `rules/80_access_control.md` |
| `rru-skill-model-alignment` | Fixed Skill Model Compliance | MUST | `reference` | Fixed Skill Model Compliance. | Prevents scope drift and keeps responsibilities aligned across the four execution skills. | `rules/90_skill_model_alignment.md` |

## Inline Rules
#### Source: `.shared-rules/60_output_discipline.md`

### Rule: Output and Planning Discipline
**Rule ID:** sr-output-discipline  
**Priority:** MUST  
**Applies to:** react-architecture-detection, react-placement-and-layering, react-reuse-update-new, react-implementation-discipline, react-refactoring-progression  
**Inherited from:** shared-rules  
**Rationale:** Keeps downstream planning and implementation outputs consistent,
compact, and reviewable.
**Covers:** Output and Planning Discipline.
**Index mode:** inline

### Requirement

- Planning outputs must include:
  - File touch plan (`Create`/`Update`/`Reuse` with paths).
  - Layer justification.
  - Reuse decision notes (`reuse as-is`, `updated`, `new`).
  - A short decision explanation that states detected architecture signals and
    chosen direction.
- Planning outputs must use a machine-readable JSON object with:
  - `output_mode` (`human|agent`)
  - `presentation.user_markdown` (prettified summary of the payload)
  - `notes[]` limited to 5 items
- Resolve `output_mode` precedence and display behavior via
  `sr-output-mode-resolution`.
- The full JSON payload is always produced for both `output_mode` values.
- If `output_mode=human`, print/display only `presentation.user_markdown` to the human.
- If `output_mode=human`, do not print/display raw JSON, envelope fields, or any payload field other than `presentation.user_markdown`.
- If `output_mode=agent`, print/display the full JSON payload.
- Implementation output must:
  - Use changed snippets for updated files by default.
  - Use unified diff when edits are scattered across non-adjacent regions.
  - Use full content for new files.

### Forbidden

- Full existing-file dumps unless explicitly requested or file is small and
  fully changed.
- Unstructured narrative-only planning outputs.
- Omitting `presentation.user_markdown` from output payloads.
- Selecting `output_mode=agent` by habit/default when a human-invoked run does
  not explicitly request machine-readable output.

---

#### Source: `.shared-rules/230_mega_file_triage.md`

### Rule: Mega-File Safety Checks and Output Contract
**Rule ID:** sr-mega-file-validation-output  
**Priority:** MUST  
**Applies to:** react-placement-and-layering, react-reuse-update-new, react-implementation-discipline, react-refactoring-progression  
**Inherited from:** shared-rules  
**Rationale:** Enforces post-step safety evidence and deterministic output
shape.
**Covers:** Mega-File Safety Checks and Output Contract.
**Index mode:** inline

### Requirement

- After each extraction step, verify:
  - TypeScript still compiles (or would compile under existing config),
  - imports remain boundary-compliant,
  - anchor public API (props/exports) is unchanged unless explicitly requested,
  - no runtime behavior change unless requested,
  - tests are updated only when behavior changes and suite exists.
- Output when triggered must include:
  - phased A->D plan with file-touch list per phase,
  - declaration: `in_cap_minimal_reduction` (default) or
    `scope_expansion_needed`,
  - implementation preference: unified diff for mega anchor edits and full
    content for newly extracted files.
- Keep extraction anti-churn constraints explicit:
  - no `shared/common` dumping-ground creation,
  - no new domain logic in `ui/**`,
  - no fetching outside canonical endpoint layer,
  - no broad formatting-only churn,
  - no new mode/flag matrices to force reuse,
  - no new barrels where local area does not already use barrels.

### Forbidden

- Skipping required safety checks after extraction steps.
- Returning mega-file plan output without phased touches and plan declaration.
- Introducing anti-churn violations under mega-file triage scope.

---

#### Source: `.shared-rules/390_output_mode_resolution.md`

### Rule: Output Mode Resolution and Display Safety
**Rule ID:** sr-output-mode-resolution  
**Priority:** MUST  
**Applies to:** react-architecture-detection, react-placement-and-layering, react-reuse-update-new, react-implementation-discipline, react-refactoring-progression  
**Inherited from:** shared-rules  
**Rationale:** Prevents accidental machine-mode output to humans and enforces
deterministic mode selection.
**Covers:** Output Mode Resolution and Display Safety.
**Index mode:** inline

### Requirement

- Resolve `output_mode` using strict precedence:
  1. if request explicitly sets `output_mode`, honor it,
  2. else if requester explicitly asks for machine-readable/raw JSON output
     (automation/integration intent), set `output_mode=agent`,
  3. else if a human explicitly asks to run/use the skill, set
     `output_mode=human`,
  4. else default to `output_mode=agent`.
- Ambiguity fallback:
  - when uncertain between human and agent, choose `output_mode=human`.
- Display contract remains strict:
  - if `output_mode=human`, display only `presentation.user_markdown`,
  - if `output_mode=agent`, display full JSON payload.
- A human-invoked skill run must not infer automation intent unless the human
  explicitly requests machine-readable output.

### Forbidden

- Selecting `output_mode=agent` by habit/default when a human explicitly
  requested skill usage and did not request machine-readable output.
- Inferring automation intent without explicit signal from the request context.
- Displaying raw JSON to a human when `output_mode=human`.

---

#### Source: `rules/20_output.md`

### Rule: Structured Decision Output
**Rule ID:** rru-output  
**Priority:** MUST  
**Applies to:** react-reuse-update-new  
**Rationale:** Ensures decisions are actionable and traceable.
**Covers:** Structured Decision Output.
**Index mode:** inline

### Requirement

- Output must be one JSON object with `schema_version`, `skill`, `version`,
  `output_mode`, `presentation`, `result_type`, and `validation_status`.
- `output_mode` must be `human` or `agent`.
- `presentation.user_markdown` must be a prettified markdown summary of the
  payload.
- `result_type=decision_plan` outputs must include:
  - `thresholds_applied`
  - `revised_plan.source_plan_ref`
  - `revised_plan.context_decisions`
  - `revised_plan.file_actions[]`
  - `revised_plan.layer_justifications[]`
  - per-artifact `decisions[]` entries
- Each decision entry must include:
  - `needed_artifact_id`
  - `decision` (`reuse|update|new|decision_blocked`)
  - `decision_mark` (`reuse as-is|updated|new|decision_blocked`)
  - `discovery_status` (`found|not_found`)
  - concise `reasons[]`
  - `override_required`
- If `discovery_status=found`, output must include concrete `discovery_paths[]`.
- If `decision` is `reuse`, `update`, or `new`, `target_path` must be present.
- If `decision` is `reuse` or `update`, `discovery_status` must be `found`.
- If score details are included, they must use `fit`, `complexity_cost`,
  `coupling_risk`, `divergence_risk`, and `locality_benefit`.
- `reuse`, `update`, and `new` decisions must include `score_profile`.
- If tie-break logic is applied, output must include `tie_break` metadata with
  ordered criteria and selected candidate information.
- Output must include explicit guardrails describing anti-leakage constraints.
- `revised_plan.guardrails[]` must also include concise constraints against:
  - new shared/common dumping-ground abstractions
  - non-user-facing top-level `features/<name>/` creation when
    owner-scoped modules or `lib/**` are appropriate
  - new sibling top-level feature roots with normalized stem/prefix overlap
    against existing feature owners
  - endpoint bypass patterns in hooks/UI layers
  - casual shared API client surface expansion when endpoint behavior is not
    stable and cross-domain
  - inline utility placement in pages/sections when the utility belongs in
    domain/lib boundaries
  - mega component expansion through excessive mode/flag props
  - forcing multi-mode shared composites when section-level duplication is safer
  - "refactor for future" scope creep without immediate value
  - mixed migration + feature-behavior churn in one decision package unless explicitly requested
- `revised_plan.file_actions[]` must map each planned touch to `create`,
  `update`, or `reuse` and include `needed_artifact_id`, `layer`, and concrete
  `path`.
- `revised_plan.file_actions[]` and `revised_plan.decisions[]` must match
  one-to-one by `needed_artifact_id` (no missing or extra ids in either list).
- `revised_plan.file_actions[]` must preserve `placement_plan` layer/path
  decisions by default.
- If a file action intentionally deviates from upstream `placement_plan`
  layer/path, output must include `revised_plan.placement_overrides[]` with:
  - `needed_artifact_id`
  - `upstream_path`
  - `upstream_layer`
  - `revised_path`
  - `revised_layer`
  - `resolution_mode` (`pause_resolved`)
  - `resolution_reason`
- If any move/rename is planned, output must include `revised_plan.move_actions[]`
  entries with `from_path`, `to_path`, and `import_update_targets[]`.
- `revised_plan.move_actions[]` must contain at most 3 entries unless
  `revised_plan.migration_scope_enabled=true`.
- `revised_plan.layer_justifications[]` must provide concise layer rationale and
  why adjacent layers were not chosen (1-2 sentences per touched layer).
- `decision_blocked` entries must include:
  - `constraint_blockers[]`
  - `override_required=true`
  - concise rationale describing why all safe paths were blocked
- `result_type=validation_error` outputs must include:
  - `validation_status.is_valid=false`
  - `notes[]` (max 5)
  - no decision payload
- `result_type=dependency_error` outputs must include:
  - `validation_status.is_valid=false`
  - `dependency_issue`
  - `fallback_context_bundle_requirements[]`
  - `notes[]` (max 5)
  - no decision payload
- `decision_plan` outputs must include concise `revised_plan.notes[]` (max 5)
  containing only high-leverage tradeoffs, uncertainties, constraints, or risks.
- `thresholds_applied` must always include:
  - `max_new_props_for_update`
  - `max_flags_allowed_composites`
  - `max_generic_flags_allowed_primitives`
  - `max_abstraction_risk_score`
- If scope caps would be exceeded for materially improved completeness, output
  may include `scope_expansion_needed[]` with bounded `why` and `would_touch`
  entries while still providing an in-cap minimal decision package.
- When `scope_expansion_needed[]` is present, include
  `revised_plan.follow_up_scope[]` as a short, concrete post-approval scope
  list.
- `needed_artifact_id` values must remain stable from request artifacts to
  final decision records.
- `needed_artifact_id` values must be unique within one `decision_plan` output.
- Resolve payload/display behavior for `output_mode` via
  `sr-output-discipline` and `sr-output-mode-resolution`.

### Forbidden

- Output that hides decision rationale.
- Ambiguous decisions without a single final action per artifact.
- Extra prose outside JSON output when `output_mode=agent`.
- Displaying raw JSON to humans when `output_mode=human`.
- `decision_blocked` outputs without actionable blocker context.

### Notes

- Keep reasoning concise and focused on material tradeoffs.
