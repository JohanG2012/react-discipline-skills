<!--
DO NOT EDIT THIS FILE DIRECTLY.

This file is generated from ./.shared-rules/*.md and ./rules/*.md
Edit the rule source files instead, then recompile.

Generated on: 2026-02-28
-->

# React Architecture Detection â€” Agent Rule Index

## Overview
This document defines the authoritative lookup index for agents/LLMs using the `react-architecture-detection` skill.

Shared baseline policy is materialized per skill in `./.shared-rules/` to keep this skill portable when installed standalone.

Read behavior:
- `inline` rules are embedded below and must be treated as always-on guidance.
- `reference` rules are listed in the index; load them from their source file when relevant.

Inline rules in this document: 3.

## Rule Lookup Index
| Rule ID | Rule | Priority | Mode | Covers | Rationale | Source |
| --- | --- | --- | --- | --- | --- | --- |
| `sr-overview-scope` | Skill Scope Definition | MUST | `reference` | Skill Scope Definition. | Keeps shared baseline governance and scope constraints explicit. | `.shared-rules/00_overview.md` |
| `sr-overview-nongoals` | Baseline Non-goals | MUST | `reference` | Baseline Non-goals. | Prevents policy drift into implementation-specific prescriptions. | `.shared-rules/00_overview.md` |
| `sr-constraints` | Minimal Scope Enforcement | MUST | `reference` | Minimal Scope Enforcement. | Prevents uncontrolled scope expansion and dependency creep. | `.shared-rules/10_constraints.md` |
| `sr-scope-governor` | Scope Governor Hard Defaults | MUST | `reference` | Scope Governor Hard Defaults. | Controls churn and keeps delivery bounded. | `.shared-rules/10_constraints.md` |
| `sr-governance` | Governance Compliance | MUST | `reference` | Governance Compliance. | Ensures policies are enforced consistently across changes. | `.shared-rules/20_governance.md` |
| `sr-architecture-boundaries` | Architecture and Dependency Boundaries | MUST | `reference` | Architecture and Dependency Boundaries. | Ensures all downstream skills enforce one consistent architecture and import-boundary model. | `.shared-rules/30_architecture_boundaries.md` |
| `sr-ownership-naming` | Ownership and Naming Contract | MUST | `reference` | Ownership and Naming Contract. | Keeps responsibility boundaries and naming deterministic across all downstream specs. | `.shared-rules/40_ownership_naming.md` |
| `sr-decision-defaults` | Deterministic Defaults and Pause Protocol | MUST | `reference` | Deterministic Defaults and Pause Protocol. | Reduces unnecessary clarification loops while protecting high-impact structural decisions. | `.shared-rules/50_decision_defaults.md` |
| `sr-output-discipline` | Output and Planning Discipline | MUST | `inline` | Output and Planning Discipline. | Keeps downstream planning and implementation outputs consistent, compact, and reviewable. | `.shared-rules/60_output_discipline.md` |
| `sr-migration-placement` | Migration and Placement Strategy | MUST | `reference` | Migration and Placement Strategy. | Prevents mixed-architecture drift and keeps placement decisions deterministic in legacy or evolving repositories. | `.shared-rules/90_migration_placement.md` |
| `sr-fallback-defaults` | Fallback Technology Defaults | MUST | `reference` | Fallback Technology Defaults. | Ensures deterministic cross-skill defaults while honoring existing repository gravity first. | `.shared-rules/100_fallback_defaults.md` |
| `sr-layer-contracts` | Layer Contracts and Error Ownership | MUST | `reference` | Layer Contracts and Error Ownership. | Keeps ownership deterministic across pages, features, UI, API, store, core, hooks, lib, and config. | `.shared-rules/120_layer_contracts.md` |
| `sr-access-write-control` | Access and Write Control | MUST | `reference` | Access and Write Control. | Keeps structural decisions grounded in repository signals and maintains controlled, reviewable changes. | `.shared-rules/130_access_write_control.md` |
| `sr-file-size-guidance` | File Size and Responsibility Guidance | SHOULD | `reference` | File Size and Responsibility Guidance. | Encourages maintainable module boundaries and limits responsibility drift. | `.shared-rules/140_file_size_guidance.md` |
| `sr-architecture-detection-contract` | Architecture Detection Output and Bootstrap Contract | MUST | `reference` | Architecture Detection Output and Bootstrap Contract. | Ensures all downstream skills consume one consistent architecture-detection result and bootstrap behavior. | `.shared-rules/150_architecture_detection_contract.md` |
| `sr-enforcement-heuristics` | Enforcement Heuristics | SHOULD | `reference` | Enforcement Heuristics. | Provides consistent review heuristics across downstream skills without over-prescribing implementation details. | `.shared-rules/160_enforcement_heuristics.md` |
| `sr-type-like-maybe` | `*Like` and `Maybe<T>` Discipline Index | MUST | `reference` | *Like and Maybe<T> Discipline. | Preserves backward-compatible entrypoint while delegating to single-focus type rules. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-type-like-boundary` | `*Like` Boundary Discipline | MUST | `reference` | *Like Boundary Discipline. | Restricts structural compatibility types to boundary layers. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-type-maybe-semantics` | `Maybe<T>` Semantics Discipline | MUST | `reference` | Maybe<T> Semantics Discipline. | Enforces one explicit repository-wide optionality semantic. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-domain-type-integrity` | Domain Type Integrity | MUST | `reference` | Domain Type Integrity. | Keeps domain-layer contracts strict and canonical. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-features-no-cross-deps` | No Cross-Feature Dependencies | MUST | `reference` | No Cross-Feature Dependencies. | Preserve clear ownership and prevent feature-graph coupling that causes architectural drift and refactor explosions. | `.shared-rules/300_features_no_cross_deps.md` |
| `sr-types-assertion-discipline` | Type Assertion Discipline (`as T`) | MUST | `reference` | Type Assertion Discipline (as T). | Allow necessary inference help without enabling type lies that bypass boundaries, validation, and domain integrity. | `.shared-rules/310_types_assertion_discipline.md` |
| `sr-types-double-assertion` | Double Type Assertion Discipline (`as unknown as T`) | MUST | `reference` | Double Type Assertion Discipline (as unknown as T). | Prevents silencing type errors and leaking unsafe shapes across boundaries while allowing rare, justified boundary interop. | `.shared-rules/320_types_double_assertion_discipline.md` |
| `sr-import-alias-suggestion` | Deep Relative Imports Should Trigger `@/` Alias Suggestion | MUST | `reference` | Deep Relative Imports Should Trigger @/ Alias Suggestion. | Reduces brittle path traversal noise while keeping alias adoption as an explicit, human-approved tooling decision. | `.shared-rules/330_import_alias_suggestion.md` |
| `sr-filename-length` | File Name Length Discipline | MUST | `reference` | File Name Length Discipline. | Long file names reduce grepability, readability, and review velocity, and often signal mixed responsibilities. | `.shared-rules/380_filename_length_policy.md` |
| `sr-output-mode-resolution` | Output Mode Resolution and Display Safety | MUST | `inline` | Output Mode Resolution and Display Safety. | Prevents accidental machine-mode output to humans and enforces deterministic mode selection. | `.shared-rules/390_output_mode_resolution.md` |
| `rad-overview-scope` | Skill Scope Definition | MUST | `reference` | Skill Scope Definition. | Ensures architecture detection stays within its defined responsibility. | `rules/00_overview.md` |
| `rad-process` | Deterministic Signal Scan | MUST | `reference` | Deterministic Signal Scan. | Ensures architecture classification is evidence-based and repeatable across runs. | `rules/10_process.md` |
| `rad-output` | Structured Output | MUST | `inline` | Structured Output. | Ensures downstream skills can consume architecture output without reinterpretation. | `rules/20_output.md` |
| `rad-migration-safety` | Strategy and One-Home Discipline | MUST | `reference` | Strategy and One-Home Discipline. | Prevents parallel-architecture guidance and unsafe migration recommendations. | `rules/30_migration_safety.md` |
| `rad-default-bias` | Default Bias and Clean Pause Protocol | MUST | `reference` | Default Bias and Clean Pause Protocol. | Keeps detection decisive while pausing only for high-impact structural ambiguity. | `rules/40_default_bias_pause.md` |
| `rad-access-control` | Repository Evidence Access | MUST | `reference` | Repository Evidence Access. | Reliable detection requires direct repository signals or explicit fallback context. | `rules/50_access_control.md` |
| `rad-skill-model-alignment` | Fixed Execution-Skill Scope | MUST | `reference` | Fixed Execution-Skill Scope. | Prevents ownership drift between detection and downstream skills. | `rules/60_skill_model_alignment.md` |
| `rad-fast-path-cache` | Fast-path Detection Reuse | MUST | `reference` | Fast-path Detection Reuse. | Speeds repeat detection runs without weakening confidence, consistency, or schema correctness. | `rules/70_fast_path_cache.md` |

## Inline Rules
#### Source: `.shared-rules/60_output_discipline.md`

### Rule: Output and Planning Discipline
**Rule ID:** sr-output-discipline  
**Priority:** MUST  
**Applies to:** react-architecture-detection, react-placement-and-layering, react-reuse-update-new, react-implementation-discipline, react-refactoring-progression  
**Inherited from:** shared-rules  
**Rationale:** Keeps downstream planning and implementation outputs consistent,
compact, and reviewable.
**Covers:** Output and Planning Discipline.
**Index mode:** inline

### Requirement

- Planning outputs must include:
  - File touch plan (`Create`/`Update`/`Reuse` with paths).
  - Layer justification.
  - Reuse decision notes (`reuse as-is`, `updated`, `new`).
  - A short decision explanation that states detected architecture signals and
    chosen direction.
- Planning outputs must use a machine-readable JSON object with:
  - `output_mode` (`human|agent`)
  - `presentation.user_markdown` (prettified summary of the payload)
  - `notes[]` limited to 5 items
- Resolve `output_mode` precedence and display behavior via
  `sr-output-mode-resolution`.
- The full JSON payload is always produced for both `output_mode` values.
- If `output_mode=human`, print/display only `presentation.user_markdown` to the human.
- If `output_mode=human`, do not print/display raw JSON, envelope fields, or any payload field other than `presentation.user_markdown`.
- If `output_mode=agent`, print/display the full JSON payload.
- Implementation output must:
  - Use changed snippets for updated files by default.
  - Use unified diff when edits are scattered across non-adjacent regions.
  - Use full content for new files.

### Forbidden

- Full existing-file dumps unless explicitly requested or file is small and
  fully changed.
- Unstructured narrative-only planning outputs.
- Omitting `presentation.user_markdown` from output payloads.
- Selecting `output_mode=agent` by habit/default when a human-invoked run does
  not explicitly request machine-readable output.

---

#### Source: `.shared-rules/390_output_mode_resolution.md`

### Rule: Output Mode Resolution and Display Safety
**Rule ID:** sr-output-mode-resolution  
**Priority:** MUST  
**Applies to:** react-architecture-detection, react-placement-and-layering, react-reuse-update-new, react-implementation-discipline, react-refactoring-progression  
**Inherited from:** shared-rules  
**Rationale:** Prevents accidental machine-mode output to humans and enforces
deterministic mode selection.
**Covers:** Output Mode Resolution and Display Safety.
**Index mode:** inline

### Requirement

- Resolve `output_mode` using strict precedence:
  1. if request explicitly sets `output_mode`, honor it,
  2. else if requester explicitly asks for machine-readable/raw JSON output
     (automation/integration intent), set `output_mode=agent`,
  3. else if a human explicitly asks to run/use the skill, set
     `output_mode=human`,
  4. else default to `output_mode=agent`.
- Ambiguity fallback:
  - when uncertain between human and agent, choose `output_mode=human`.
- Display contract remains strict:
  - if `output_mode=human`, display only `presentation.user_markdown`,
  - if `output_mode=agent`, display full JSON payload.
- A human-invoked skill run must not infer automation intent unless the human
  explicitly requests machine-readable output.

### Forbidden

- Selecting `output_mode=agent` by habit/default when a human explicitly
  requested skill usage and did not request machine-readable output.
- Inferring automation intent without explicit signal from the request context.
- Displaying raw JSON to a human when `output_mode=human`.

---

#### Source: `rules/20_output.md`

### Rule: Structured Output
**Rule ID:** rad-output  
**Priority:** MUST  
**Applies to:** react-architecture-detection  
**Rationale:** Ensures downstream skills can consume architecture output without
reinterpretation.
**Covers:** Structured Output.
**Index mode:** inline

### Requirement

- Output must be one machine-readable JSON object only.
- Root fields are mandatory for every result:
  - `schema_version`
  - `skill`
  - `version`
  - `output_mode`
  - `presentation`
  - `result_type`
  - `validation_status`
- `output_mode` must be exactly one of:
  - `human`
  - `agent`
- `presentation` must include:
  - `user_markdown` (prettified markdown summary of the payload)
- `result_type` must be exactly one of:
  - `detection_result`
  - `validation_error`
  - `dependency_error`
- `detection_result` must include at minimum:
  - `routing`
  - `ui`
  - `api`
  - `domain`
  - `state`
  - `gravity_map`
  - `alignment_score`
  - `alignment`
  - `strategy`
  - `strategy_rationale`
  - `pause_decision`
  - `notes`
- `detection_result` must include one canonical `api.home` and one
  authoritative `gravity_map`.
- `detection_result` must include alignment blockers and one
  next-migration step.
- `detection_result` may include `strategy_basis` and `bootstrap` metadata when
  applicable.
- `validation_error` must include `notes` and must not include detection fields.
- `dependency_error` must include:
  - `dependency_issue`
  - `fallback_context_bundle_requirements`
  - `notes`
  and must not include detection fields.
- `notes[]` must remain concise (maximum 5 items).
- Output fields must contain structural metadata only (no raw source snippets).
- Resolve payload/display behavior for `output_mode` via
  `sr-output-discipline` and `sr-output-mode-resolution`.

### Required fields

- `pause_decision` must be emitted for every `detection_result`.
- `pause_decision` must include:
  - `pause_required`
  - `pause_mode`
  - `decision_safety_confidence`
  - `impact`
- When `pause_required=true`, output must also include:
  - `trigger`
  - `options` (2-3 bounded options)
  - `recommended_option`

### Forbidden

- Returning free-form prose outside JSON output when `output_mode=agent`.
- Displaying raw JSON to humans when `output_mode=human`.
- Returning more than one strategy for one task.
- Omitting required fields for selected `result_type`.
- Returning error result types with detection payload fields.
- Omitting canonical endpoint-layer metadata (`api.home`) in
  `detection_result`.

### Notes

- `schema_version` is required on every payload revision.
- Keep output deterministic so downstream skills can reuse it without
  recomputation.
