<!--
DO NOT EDIT THIS FILE DIRECTLY.

This file is generated from ./.shared-rules/*.md and ./rules/*.md
Edit the rule source files instead, then recompile.

Generated on: 2026-02-28
-->

# React Refactoring Progression — Agent Rule Index

## Overview
This document defines the authoritative lookup index for agents/LLMs using the `react-refactoring-progression` skill.

Shared baseline policy is materialized per skill in `./.shared-rules/` to keep this skill portable when installed standalone.

Read behavior:
- `inline` rules are embedded below and must be treated as always-on guidance.
- `reference` rules are listed in the index; load them from their source file when relevant.

Inline rules in this document: 6.

## Rule Lookup Index
| Rule ID | Rule | Priority | Mode | Covers | Rationale | Source |
| --- | --- | --- | --- | --- | --- | --- |
| `sr-output-discipline` | Output and Planning Discipline | MUST | `inline` | Output and Planning Discipline. | Keeps downstream planning and implementation outputs consistent, compact, and reviewable. | `.shared-rules/60_output_discipline.md` |
| `sr-layer-contracts` | Layer Contracts and Error Ownership | MUST | `reference` | Layer Contracts and Error Ownership. | Keeps ownership deterministic across pages, features, UI, API, store, core, hooks, lib, and config. | `.shared-rules/120_layer_contracts.md` |
| `sr-file-size-guidance` | File Size and Responsibility Guidance | SHOULD | `reference` | File Size and Responsibility Guidance. | Encourages maintainable module boundaries and limits responsibility drift. | `.shared-rules/140_file_size_guidance.md` |
| `sr-enforcement-heuristics` | Enforcement Heuristics | SHOULD | `reference` | Enforcement Heuristics. | Provides consistent review heuristics across downstream skills without over-prescribing implementation details. | `.shared-rules/160_enforcement_heuristics.md` |
| `sr-dom-rendering-and-primitives` | DOM Rendering and Primitive Discipline Index | MUST | `reference` | DOM Rendering and Primitive Discipline. | Preserves backward-compatible entrypoint while delegating enforcement to narrowly scoped rules. | `.shared-rules/210_dom_rendering_and_primitive_discipline.md` |
| `sr-dom-rendering-boundaries` | DOM Rendering Boundaries | MUST | `reference` | DOM Rendering Boundaries. | Prevents JSX/DOM leakage into logic/data layers. | `.shared-rules/210_dom_rendering_and_primitive_discipline.md` |
| `sr-primitive-creation-threshold` | Primitive Creation Threshold and Raw DOM Usage | MUST | `reference` | Primitive Creation Threshold and Raw DOM Usage. | Keeps raw DOM use pragmatic while preventing repeated semantic reimplementation. | `.shared-rules/210_dom_rendering_and_primitive_discipline.md` |
| `sr-shared-ui-domain-discipline` | Shared UI Domain Discipline | MUST | `reference` | Shared UI Domain Discipline. | Keeps shared UI reusable and prevents domain/transport leakage. | `.shared-rules/210_dom_rendering_and_primitive_discipline.md` |
| `sr-prop-count-caps` | Prop Count Caps and Escalation Actions | SHOULD | `reference` | Prop Count Caps and Escalation Actions. | Prevents prop soup and abstraction creep by enforcing responsibility boundaries and preferring composition/wrappers over flag matrices. | `.shared-rules/220_prop_count_caps.md` |
| `sr-mega-file-triage` | Mega-File Triage and Extraction Plan Index | MUST | `reference` | Mega-File Triage and Extraction Plan. | Preserves stable entrypoint while delegating to focused triage, extraction-sequencing, and validation-output rules. | `.shared-rules/230_mega_file_triage.md` |
| `sr-mega-file-trigger-safety` | Mega-File Trigger and Safety Baseline | MUST | `reference` | Mega-File Trigger and Safety Baseline. | Ensures deterministic trigger conditions and behavior-preserving triage defaults. | `.shared-rules/230_mega_file_triage.md` |
| `sr-mega-file-extraction-order` | Mega-File Extraction Ordering | MUST | `reference` | Mega-File Extraction Ordering. | Keeps decomposition predictable and low-risk. | `.shared-rules/230_mega_file_triage.md` |
| `sr-mega-file-validation-output` | Mega-File Safety Checks and Output Contract | MUST | `inline` | Mega-File Safety Checks and Output Contract. | Enforces post-step safety evidence and deterministic output shape. | `.shared-rules/230_mega_file_triage.md` |
| `sr-prop-grouping-discipline` | Prop Grouping Discipline | SHOULD | `reference` | Prop Grouping Discipline. | Keeps prop grouping intentional and cohesive while preventing config-bag anti-patterns that hide responsibility drift. | `.shared-rules/240_prop_grouping_discipline.md` |
| `sr-i18n-text-extraction` | i18n Extraction for User-Facing UI Text | MUST | `reference` | i18n Extraction for User-Facing UI Text. | Prevents hardcoded copy drift and keeps user-facing text maintainable, localizable, and consistent. | `.shared-rules/250_i18n_text_extraction.md` |
| `sr-type-like-maybe` | `*Like` and `Maybe<T>` Discipline Index | MUST | `reference` | *Like and Maybe<T> Discipline. | Preserves backward-compatible entrypoint while delegating to single-focus type rules. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-type-like-boundary` | `*Like` Boundary Discipline | MUST | `reference` | *Like Boundary Discipline. | Restricts structural compatibility types to boundary layers. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-type-maybe-semantics` | `Maybe<T>` Semantics Discipline | MUST | `reference` | Maybe<T> Semantics Discipline. | Enforces one explicit repository-wide optionality semantic. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-domain-type-integrity` | Domain Type Integrity | MUST | `reference` | Domain Type Integrity. | Keeps domain-layer contracts strict and canonical. | `.shared-rules/260_type_like_maybe_discipline.md` |
| `sr-tests-aria-label-selectors` | Test Selectors and `aria-label` Usage | MUST | `reference` | Test Selectors and aria-label Usage. | Keep tests user-centric and stable without abusing accessibility attributes as test-only hooks. | `.shared-rules/270_tests_aria_label_selectors.md` |
| `sr-no-duplicate-ui-patterns` | No Duplicate UI Patterns (Composites) | MUST | `reference` | No Duplicate UI Patterns (Composites). | Prevent parallel implementations of the same UI interaction pattern that cause drift, inconsistent behavior, and refactor churn. | `.shared-rules/280_no_duplicate_ui_patterns.md` |
| `sr-browser-side-effects-boundary` | Browser Side-Effects and Routing Boundary | MUST | `reference` | Browser Side-Effects and Routing Boundary. | Prevents hidden routing/app side-effects from leaking into UI/feature components and keeps navigation/history ownership deterministic. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-no-empty-catch` | Empty Catch and Swallowed Error Discipline | MUST | `reference` | Empty Catch and Swallowed Error Discipline. | Silent failures destroy debuggability and make behavior nondeterministic. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-jsx-logic-density` | JSX Logic Density and Handler Extraction | SHOULD | `reference` | JSX Logic Density and Handler Extraction. | Prevents JSX from becoming an execution script and improves readability/testability without premature performance optimization. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-time-derived-state` | Time and "Now" Semantics in Derived State | SHOULD | `reference` | Time and "Now" Semantics in Derived State. | Prevents hidden time dependencies that create stale values, flaky tests, and inconsistent behavior. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-hidden-interactive-controls` | Hidden Interactive Controls and Accessibility Contract | MUST | `reference` | Hidden Interactive Controls and Accessibility Contract. | Prevents invisible/focus-trap controls and accessibility regressions from CSS hiding patterns. | `.shared-rules/290_side_effects_error_jsx_time_a11y_controls.md` |
| `sr-features-no-cross-deps` | No Cross-Feature Dependencies | MUST | `reference` | No Cross-Feature Dependencies. | Preserve clear ownership and prevent feature-graph coupling that causes architectural drift and refactor explosions. | `.shared-rules/300_features_no_cross_deps.md` |
| `sr-types-assertion-discipline` | Type Assertion Discipline (`as T`) | MUST | `reference` | Type Assertion Discipline (as T). | Allow necessary inference help without enabling type lies that bypass boundaries, validation, and domain integrity. | `.shared-rules/310_types_assertion_discipline.md` |
| `sr-types-double-assertion` | Double Type Assertion Discipline (`as unknown as T`) | MUST | `reference` | Double Type Assertion Discipline (as unknown as T). | Prevents silencing type errors and leaking unsafe shapes across boundaries while allowing rare, justified boundary interop. | `.shared-rules/320_types_double_assertion_discipline.md` |
| `sr-import-alias-suggestion` | Deep Relative Imports Should Trigger `@/` Alias Suggestion | MUST | `reference` | Deep Relative Imports Should Trigger @/ Alias Suggestion. | Reduces brittle path traversal noise while keeping alias adoption as an explicit, human-approved tooling decision. | `.shared-rules/330_import_alias_suggestion.md` |
| `sr-feature-split-domain-extraction` | Umbrella Feature Split and Domain Extraction | MUST | `reference` | Umbrella Feature Split and Domain Extraction. | Prevent feature folders from turning into umbrella owners that hide multiple domains and destabilize placement/reuse boundaries. | `.shared-rules/340_feature_split_domain_extraction.md` |
| `sr-feature-components-scope` | What May Live in `features/<domain>/components/` | MUST | `reference` | What May Live in features/<domain>/components/. | Prevents feature components from becoming a second shared UI home or hiding domain/transport logic in presentation files. | `.shared-rules/350_feature_components_scope.md` |
| `sr-no-feature-api-home` | No `api/` Inside Features When Canonical API Home Exists | MUST | `reference` | No api/ Inside Features When Canonical API Home Exists. | Preserves one-home-per-concern for transport ownership and prevents endpoint drift into feature folders. | `.shared-rules/360_no_feature_api_home.md` |
| `sr-no-feature-views` | No `views/` or `*View` in Features | MUST | `reference` | No views/ or *View in Features. | Keeps presentation ownership deterministic across pages, sections, and components without introducing duplicate view layers. | `.shared-rules/370_no_feature_views.md` |
| `sr-filename-length` | File Name Length Discipline | MUST | `reference` | File Name Length Discipline. | Long file names reduce grepability, readability, and review velocity, and often signal mixed responsibilities. | `.shared-rules/380_filename_length_policy.md` |
| `sr-output-mode-resolution` | Output Mode Resolution and Display Safety | MUST | `inline` | Output Mode Resolution and Display Safety. | Prevents accidental machine-mode output to humans and enforces deterministic mode selection. | `.shared-rules/390_output_mode_resolution.md` |
| `sr-props-drilling-discipline` | Prop Drilling Discipline and Escalation | SHOULD | `reference` | Prop Drilling Discipline and Escalation. | Keep component trees readable and maintainable by limiting pass-through wiring while preserving clear ownership boundaries. | `.shared-rules/400_prop_drilling_discipline.md` |
| `sr-feature-definition` | Feature Definition and Composition Boundary | MUST | `reference` | Feature Definition and Composition Boundary. | Keeps feature ownership explicit and prevents route/transport/layout drift into feature boundaries. | `.shared-rules/410_feature_definition.md` |
| `sr-feature-capability-clusters` | Capability Cluster Policy Inside Feature Owners | MUST | `reference` | Capability Cluster Policy Inside Feature Owners. | Prevents premature taxonomy growth while making structural extraction criteria deterministic when feature scope expands. | `.shared-rules/420_feature_capability_clusters.md` |
| `sr-capability-to-feature-split` | Capability Promotion to Feature Owner | MUST | `reference` | Capability Promotion to Feature Owner. | Prevents both premature feature explosion and hidden feature-sized ownership inside one folder. | `.shared-rules/430_capability_to_feature_split.md` |
| `sr-feature-state-policy` | Feature-Local State Admission and Graduation | MUST | `reference` | Feature-Local State Admission and Graduation. | Prevents unnecessary state layers while preserving explicit ownership for durable cross-route client state. | `.shared-rules/440_feature_state_policy.md` |
| `sr-capability-domain-scope` | Capability-Level Domain Scope and Promotion | MUST | `reference` | Capability-Level Domain Scope and Promotion. | Allows local domain specialization without fragmenting canonical feature domain ownership. | `.shared-rules/450_capability_domain_scope.md` |
| `sr-feature-too-big-triggers` | Feature Size Governance Triggers | MUST | `reference` | Feature Size Governance Triggers. | Keeps oversized feature drift detectable and action-oriented without forcing unsafe broad restructures. | `.shared-rules/460_feature_too_big_triggers.md` |
| `sr-capability-folder-naming` | Capability Folder Naming and Reserved Names | MUST | `reference` | Capability Folder Naming and Reserved Names. | Keeps capability structure searchable and prevents generic dumping-ground taxonomy drift. | `.shared-rules/470_capability_folder_naming.md` |
| `sr-refactor-progress-readme` | Temporary Refactor Progress README Discipline | SHOULD | `reference` | Temporary Refactor Progress README Discipline. | Medium/high-risk refactors benefit from explicit checkpoint tracking, but temporary planning artifacts must not leak into permanent history. | `.shared-rules/480_refactor_progress_tracking.md` |
| `rrp-overview-scope` | Optional Extension Scope | MUST | `reference` | Optional Extension Scope. | Keeps this skill planning-only and aligned with the fixed four-skill production pipeline. | `rules/00_overview.md` |
| `rrp-process` | Tiered Planning Sequence | MUST | `reference` | Tiered Planning Sequence. | Ensures predictable and low-risk refactor planning. | `rules/10_process.md` |
| `rrp-output` | Structured Refactor Output | MUST | `inline` | Structured Refactor Output. | Keeps outputs machine-consumable and deterministic. | `rules/20_output.md` |
| `rrp-validation-gates` | Behavior Preservation Enforcement | MUST | `reference` | Behavior Preservation Enforcement. | Prevents accidental regressions during refactor planning. | `rules/30_validation_gates.md` |
| `rrp-scope-governor` | Bounded Scope Execution | MUST | `reference` | Bounded Scope Execution. | Prevents uncontrolled refactor spread and hidden churn. | `rules/40_scope_governor.md` |
| `rrp-detection` | Anti-Pattern Findings | MUST | `reference` | Anti-Pattern Findings. | Turns known architecture drift signals into actionable planning metadata. | `rules/50_detection.md` |
| `rrp-detection-assist-scripts` | Script-Assisted Detection Candidates | MUST | `reference` | Script-Assisted Detection Candidates. | Keeps helper-script usage bounded, input-safe, and subordinate to rule-based agent judgment. | `rules/55_detection_assist_scripts.md` |
| `rrp-semantic-duplication` | Semantic Duplication Qualification | MUST | `reference` | Semantic Duplication Qualification. | Prevents unsafe abstraction and focuses on high-leverage reuse. | `rules/60_semantic_duplication.md` |
| `rrp-interactions` | Interaction Boundaries | MUST | `reference` | Interaction Boundaries. | Prevents overlap and contradiction across the fixed skill model. | `rules/70_interactions.md` |
| `rrp-progression-model` | Finalized Tier Model | MUST | `reference` | Finalized Tier Model. | Keeps tier semantics stable for reviewers and downstream automation. | `rules/80_progression_model.md` |
| `rrp-dup-pattern-types` | Pattern Type Classification | MUST | `reference` | Pattern Type Classification. | Ensures each duplication candidate maps to one clear extraction strategy. | `rules/90_duplicate_classification.md` |
| `rrp-dup-two-signals` | Two-Signal Qualification Gate | MUST | `reference` | Two-Signal Qualification Gate. | Reduces false positives from cosmetic similarity. | `rules/90_duplicate_classification.md` |
| `rrp-dup-evidence` | Structural Evidence Quality | MUST | `reference` | Structural Evidence Quality. | Keeps recommendations actionable and auditable. | `rules/90_duplicate_classification.md` |
| `rrp-dup-home-alignment` | Existing Home Alignment | MUST | `reference` | Existing Home Alignment. | Prevents introducing a second architecture home by accident. | `rules/100_duplicate_guardrails.md` |
| `rrp-dup-slots-over-props` | Slots Over Prop Matrix | MUST | `reference` | Slots Over Prop Matrix. | Avoids prop explosion and domain flags in shared UI composites. | `rules/100_duplicate_guardrails.md` |
| `rrp-dup-one-level-up` | One-Level-Up Preference | MUST | `reference` | One-Level-Up Preference. | Keeps abstraction scope proportional to the duplication source. | `rules/100_duplicate_guardrails.md` |
| `rrp-dup-keep-separate` | Keep-Separate by Default Under High Risk | MUST | `reference` | Keep-Separate by Default Under High Risk. | Treats intentional duplication as valid when abstraction is unsafe. | `rules/100_duplicate_guardrails.md` |
| `rrp-dup-locality` | Locality Preference | SHOULD | `reference` | Locality Preference. | Respects established repository sharing culture. | `rules/100_duplicate_guardrails.md` |
| `rrp-dup-cognitive-load` | Cognitive Load Guard | MUST | `reference` | Cognitive Load Guard. | DRY does not justify harder-to-understand APIs. | `rules/100_duplicate_guardrails.md` |
| `rrp-dup-refactor-radius` | Refactor Radius Bound | MUST | `reference` | Refactor Radius Bound. | Prevents high-churn suggestions in bounded planning modes. | `rules/100_duplicate_guardrails.md` |
| `rrp-dup-micro-before-mega` | Micro Extraction Before Mega Extraction | SHOULD | `reference` | Micro Extraction Before Mega Extraction. | Improves safety by extracting high-leverage subparts first. | `rules/100_duplicate_guardrails.md` |
| `rrp-dup-output` | Cluster Output Completeness | MUST | `inline` | Cluster Output Completeness. | Ensures clusters are actionable without implementation output. | `rules/110_duplicate_output.md` |
| `rrp-dup-next-actions` | Actionable Next Actions | MUST | `reference` | Actionable Next Actions. | Keeps output useful for downstream task planning. | `rules/110_duplicate_output.md` |
| `rrp-dup-keep-separate-output` | Keep-Separate Output Clarity | MUST | `inline` | Keep-Separate Output Clarity. | Makes non-extraction decisions explicit and reviewable. | `rules/110_duplicate_output.md` |
| `rrp-ui-classname-hygiene` | Refactor — `className` Hygiene and Correct Placement | MUST | `reference` | Refactor — className Hygiene and Correct Placement. | Remove style-prop drift without creating new architecture or prop soup. | `rules/120_ui_accessibility_hygiene.md` |
| `rrp-a11y-aria-label-hygiene` | Refactor — `aria-label` Hygiene and Correct Placement | MUST | `reference` | Refactor — aria-label Hygiene and Correct Placement. | Prevent ARIA misuse while ensuring every control has a correct accessible name. | `rules/120_ui_accessibility_hygiene.md` |
| `rrp-promote-feature-to-composite` | Refactor — Promote Feature Components to Shared UI Composites Safely | MUST | `reference` | Refactor — Promote Feature Components to Shared UI Composites Safely. | Enables promote-to-shared-composite refactors without domain leakage, parallel homes, or churn-heavy migration. | `rules/130_promote_feature_to_composite.md` |
| `rrp-naming-hygiene` | Refactor — Naming Hygiene and Correct Placement | MUST | `reference` | Refactor — Naming Hygiene and Correct Placement. | Prevents naming drift and misplaced ownership during refactors by aligning with established naming contracts. | `rules/140_naming_hygiene.md` |
| `rrp-test-suggestion-priority` | Implementation-First Test Suggestion Priority | MUST | `reference` | Implementation-First Test Suggestion Priority. | Prevents plans from drifting into test-only cleanup when higher impact implementation improvements are still available. | `rules/150_test_suggestion_priority.md` |

## Inline Rules
#### Source: `.shared-rules/60_output_discipline.md`

### Rule: Output and Planning Discipline
**Rule ID:** sr-output-discipline  
**Priority:** MUST  
**Applies to:** react-architecture-detection, react-placement-and-layering, react-reuse-update-new, react-implementation-discipline, react-refactoring-progression  
**Inherited from:** shared-rules  
**Rationale:** Keeps downstream planning and implementation outputs consistent,
compact, and reviewable.
**Covers:** Output and Planning Discipline.
**Index mode:** inline

### Requirement

- Planning outputs must include:
  - File touch plan (`Create`/`Update`/`Reuse` with paths).
  - Layer justification.
  - Reuse decision notes (`reuse as-is`, `updated`, `new`).
  - A short decision explanation that states detected architecture signals and
    chosen direction.
- Planning outputs must use a machine-readable JSON object with:
  - `output_mode` (`human|agent`)
  - `presentation.user_markdown` (prettified summary of the payload)
  - `notes[]` limited to 5 items
- Resolve `output_mode` precedence and display behavior via
  `sr-output-mode-resolution`.
- The full JSON payload is always produced for both `output_mode` values.
- If `output_mode=human`, print/display only `presentation.user_markdown` to the human.
- If `output_mode=human`, do not print/display raw JSON, envelope fields, or any payload field other than `presentation.user_markdown`.
- If `output_mode=agent`, print/display the full JSON payload.
- Implementation output must:
  - Use changed snippets for updated files by default.
  - Use unified diff when edits are scattered across non-adjacent regions.
  - Use full content for new files.

### Forbidden

- Full existing-file dumps unless explicitly requested or file is small and
  fully changed.
- Unstructured narrative-only planning outputs.
- Omitting `presentation.user_markdown` from output payloads.
- Selecting `output_mode=agent` by habit/default when a human-invoked run does
  not explicitly request machine-readable output.

---

#### Source: `.shared-rules/230_mega_file_triage.md`

### Rule: Mega-File Safety Checks and Output Contract
**Rule ID:** sr-mega-file-validation-output  
**Priority:** MUST  
**Applies to:** react-placement-and-layering, react-reuse-update-new, react-implementation-discipline, react-refactoring-progression  
**Inherited from:** shared-rules  
**Rationale:** Enforces post-step safety evidence and deterministic output
shape.
**Covers:** Mega-File Safety Checks and Output Contract.
**Index mode:** inline

### Requirement

- After each extraction step, verify:
  - TypeScript still compiles (or would compile under existing config),
  - imports remain boundary-compliant,
  - anchor public API (props/exports) is unchanged unless explicitly requested,
  - no runtime behavior change unless requested,
  - tests are updated only when behavior changes and suite exists.
- Output when triggered must include:
  - phased A->D plan with file-touch list per phase,
  - declaration: `in_cap_minimal_reduction` (default) or
    `scope_expansion_needed`,
  - implementation preference: unified diff for mega anchor edits and full
    content for newly extracted files.
- Keep extraction anti-churn constraints explicit:
  - no `shared/common` dumping-ground creation,
  - no new domain logic in `ui/**`,
  - no fetching outside canonical endpoint layer,
  - no broad formatting-only churn,
  - no new mode/flag matrices to force reuse,
  - no new barrels where local area does not already use barrels.

### Forbidden

- Skipping required safety checks after extraction steps.
- Returning mega-file plan output without phased touches and plan declaration.
- Introducing anti-churn violations under mega-file triage scope.

---

#### Source: `.shared-rules/390_output_mode_resolution.md`

### Rule: Output Mode Resolution and Display Safety
**Rule ID:** sr-output-mode-resolution  
**Priority:** MUST  
**Applies to:** react-architecture-detection, react-placement-and-layering, react-reuse-update-new, react-implementation-discipline, react-refactoring-progression  
**Inherited from:** shared-rules  
**Rationale:** Prevents accidental machine-mode output to humans and enforces
deterministic mode selection.
**Covers:** Output Mode Resolution and Display Safety.
**Index mode:** inline

### Requirement

- Resolve `output_mode` using strict precedence:
  1. if request explicitly sets `output_mode`, honor it,
  2. else if requester explicitly asks for machine-readable/raw JSON output
     (automation/integration intent), set `output_mode=agent`,
  3. else if a human explicitly asks to run/use the skill, set
     `output_mode=human`,
  4. else default to `output_mode=agent`.
- Ambiguity fallback:
  - when uncertain between human and agent, choose `output_mode=human`.
- Display contract remains strict:
  - if `output_mode=human`, display only `presentation.user_markdown`,
  - if `output_mode=agent`, display full JSON payload.
- A human-invoked skill run must not infer automation intent unless the human
  explicitly requests machine-readable output.

### Forbidden

- Selecting `output_mode=agent` by habit/default when a human explicitly
  requested skill usage and did not request machine-readable output.
- Inferring automation intent without explicit signal from the request context.
- Displaying raw JSON to a human when `output_mode=human`.

---

#### Source: `rules/20_output.md`

### Rule: Structured Refactor Output
**Rule ID:** rrp-output  
**Priority:** MUST  
**Applies to:** react-refactoring-progression  
**Rationale:** Keeps outputs machine-consumable and deterministic.
**Covers:** Structured Refactor Output.
**Index mode:** inline

### Requirement

- Emit one JSON object with required envelope fields:
  - `schema_version`
  - `skill`
  - `version`
  - `output_mode`
  - `presentation`
  - `result_type`
  - `validation_status`
- `output_mode` must be `human` or `agent`.
- `presentation` must include:
  - `user_markdown` (prettified markdown summary of the payload)
- Restrict `result_type` to:
  - `refactor_plan`
  - `clarification_request`
  - `validation_error`
  - `dependency_error`
- Restrict `validation_status` to:
  - `accepted`
  - `blocked`
  - `needs_clarification`
  - `validation_error`
  - `dependency_error`
- `refactor_plan` output must include:
  - `refactor_mode`
  - `plan.touch_budget`
  - `plan.steps[]`
- `refactor_plan` may include:
  - `plan.follow_up_findings[]` for non-blocking out-of-mode items
  - `plan.test_file_touches[]` for opportunistic test updates
- Opportunistic `refactor_plan` outputs must:
  - include only Tier A/B steps
  - include no more than 5 steps
  - keep Tier C/D items in `plan.follow_up_findings[]` only
- `validation_error` output must include notes and no `plan` payload.
- `clarification_request` output must include:
  - `clarification_questions[]` (1-4 items)
  - each item includes:
    - `question_id`
    - `question`
    - `options[]` with keys `A`/`B`/`C` (optional `D`)
    - `recommended_option`
  - no `plan` payload
- `dependency_error` output must include:
  - `dependency_issue`
  - `fallback_context_bundle_requirements[]` (min 5)
  - `notes[]`
  - no `plan` payload
- Include `scope_expansion_needed[]` when completeness exceeds caps but an in-cap
  plan is still returned.
- Represent Tier C/D opportunistic findings as follow-up metadata, not blocking
  step execution.
- If `plan.test_file_touches[]` is present, keep it directly relevant, bounded
  (default <=2 files), and dependency-neutral.
- `plan.test_file_touches[]` should be included only when at least one is true:
  - test updates are required by implementation-focused active steps, or
  - no meaningful implementation-focused improvements are available and
    test-only improvement is used as fallback value.
- Resolve payload/display behavior for `output_mode` via
  `sr-output-discipline` and `sr-output-mode-resolution`.
- Dedicated no-op output behavior:
  - when `refactor_mode=dedicated`, request scope is non-specific, and no
    meaningful opportunities are found, keep output minimal:
    - "no meaningful opportunities" means no actionable opportunities/findings
      were detected from active shared/skill rules in the current scope,
    - return `result_type=refactor_plan` and `validation_status=accepted`,
    - set `plan.steps=[]`,
    - keep `presentation.user_markdown` concise in human mode:
      - "No meaningful refactoring opportunities were found in current scope."
      - "Provide more specific refactor targets/instructions and run again."
  - in this no-op case, do not emit full-report markdown sections (tier
    breakdowns, long findings dumps, or duplicate-cluster detail blocks).

### Forbidden

- Emitting prose outside the JSON payload when `output_mode=agent`.
- Displaying raw JSON to humans when `output_mode=human`.
- Selecting `output_mode=agent` by habit/default when a human explicitly asked
  to run this skill and no machine-readable output was requested.
- Emitting test-only active steps while meaningful implementation-focused
  improvements remain in scope.
- Returning partial `refactor_plan` output when required context is missing.
- Returning `clarification_request` without structured options.
- Emitting non-enum status strings.
- Emitting verbose full-report human markdown for the dedicated no-op case where
  no meaningful opportunities are found.
- Emitting dedicated no-op output when any actionable rule-defined
  opportunities/findings exist in current scope.

### Notes

- All output examples must validate against the schema.

---

#### Source: `rules/110_duplicate_output.md`

### Rule: Cluster Output Completeness
**Rule ID:** rrp-dup-output  
**Priority:** MUST  
**Applies to:** react-refactoring-progression  
**Rationale:** Ensures clusters are actionable without implementation output.
**Covers:** Cluster Output Completeness.
**Index mode:** inline

### Requirement

- Every semantic duplication cluster must include:
  - `pattern_type`
  - `candidate_files[]`
  - `signals[]`
  - `evidence`
  - `recommended_target`
  - `abstraction_cost`
  - `leakage_risk`
  - `divergence_risk`
  - `refactor_radius`
  - `recommended_next_step`
  - `variation_points[]`
  - `candidate_api`
  - `non_goals[]`
- Cluster output must stay concise and structural; no patch text.

### Forbidden

- Returning semantic duplication clusters without extraction-target and risk
  metadata.
- Returning vague similarity claims without supporting evidence.

---

#### Source: `rules/110_duplicate_output.md`

### Rule: Keep-Separate Output Clarity
**Rule ID:** rrp-dup-keep-separate-output  
**Priority:** MUST  
**Applies to:** react-refactoring-progression  
**Rationale:** Makes non-extraction decisions explicit and reviewable.
**Covers:** Keep-Separate Output Clarity.
**Index mode:** inline

### Requirement

- When `recommended_target=keep_separate`, cluster output must include a
  concise `keep_separate_reason`.

### Forbidden

- Recommending `keep_separate` without rationale.
